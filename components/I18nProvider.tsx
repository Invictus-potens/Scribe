'use client';

import React, { createContext, useContext, useEffect, useMemo, useState, useCallback } from 'react';

type LanguageCode = 'pt-BR' | 'en';

type Translations = Record<string, string>;

const DICTS: Record<LanguageCode, Translations> = {
  'pt-BR': {
    'settings.title': 'Configurações',
    'settings.close': 'Fechar configurações',
    'settings.darkTheme': 'Tema escuro',
    'settings.autoRefresh': 'Auto-refresh das notas',
    'settings.doNotDisturb': 'Não perturbe (toasts)',
    'settings.language': 'Idioma',
    'lang.pt': 'Português (Brasil)',
    'lang.en': 'Inglês',
    'common.active': 'Ativo',
    'common.inactive': 'Inativo',
    'refresh.off': 'Desligado',
    'refresh.15s': '15 segundos',
    'refresh.30s': '30 segundos',
    'refresh.1m': '1 minuto',
    'editor.loading': 'Carregando editor......',
    'editor.titlePlaceholder': 'Título da nota...',
    'editor.bold': 'Negrito',
    'editor.italic': 'Itálico',
    'editor.underline': 'Sublinhado',
    'editor.strike': 'Tachado',
    'editor.heading1': 'Título 1',
    'editor.heading2': 'Título 2',
    'editor.heading3': 'Título 3',
    'editor.bulletList': 'Lista não ordenada',
    'editor.orderedList': 'Lista ordenada',
    'editor.taskList': 'Lista de tarefas',
    'editor.alignLeft': 'Alinhar à esquerda',
    'editor.alignCenter': 'Centralizar',
    'editor.alignRight': 'Alinhar à direita',
    'editor.codeInline': 'Código inline',
    'editor.codeBlock': 'Bloco de código',
    'editor.horizontalRule': 'Linha horizontal',
    'editor.insertImage': 'Inserir imagem',
    'editor.prompt.imageUrl': 'Digite a URL da imagem:',
    'editor.textColor': 'Cor do texto',
    'editor.prompt.textColor': 'Digite a cor (ex: #ff0000, red, blue):',
    'editor.fontFamily': 'Família da fonte',
    'editor.prompt.fontFamily': 'Digite a fonte (ex: Arial, Times New Roman, Courier):',
    'editor.subscript': 'Subscrito',
    'editor.superscript': 'Sobrescrito',
    'editor.highlight': 'Destacar texto',
    'editor.prompt.highlightColor': 'Digite a cor do destaque (ex: #ffff00, yellow, orange):',
    'editor.characters': 'caracteres',
    'editor.tags': 'Tags',
    'editor.addTag': 'Adicionar Tag',
    'editor.removeTag': 'Remover tag',
    'editor.tagNamePlaceholder': 'Nome da tag',
    'editor.add': 'Adicionar',
    'editor.cancel': 'Cancelar',
    'editor.noNoteSelected.title': 'Nenhuma Nota Selecionada',
    'editor.noNoteSelected.subtitle': 'Selecione uma nota da barra lateral ou crie uma nova',
    'editor.compareHeader': 'Comparar com outra nota',
    'editor.compareInstruction': 'Selecione outra nota para comparar com a nota atual',
    'editor.closeCompare': 'Fechar comparação',
    'editor.noContent': 'Sem conteúdo',
    'editor.unpin': 'Desafixar nota',
    'editor.pin': 'Fixar nota',
    'editor.unfavorite': 'Remover dos favoritos',
    'editor.favorite': 'Adicionar aos favoritos',
    'editor.unarchive': 'Desarquivar',
    'editor.archive': 'Arquivar',
    'editor.toggleSplit': 'Alternar visualização dividida',
    'editor.templates': 'Modelos',
    'editor.exportMarkdown': 'Exportar Markdown',
    'editor.exportHtml': 'Exportar HTML',
    'editor.exportPdf': 'Exportar PDF',
    'editor.exportZip': 'Exportar ZIP (MD+HTML)',
    'editor.importMdHtml': 'Importar Markdown/HTML',
    'editor.delete': 'Deletar nota',
    'editor.save': 'Salvar',
    'editor.saveWithStar': 'Salvar*',
    'sidebar.newNote': 'Nova nota',
    'sidebar.newFolder': 'Nova Pasta',
    'sidebar.filterFavorites': 'Filtrar favoritos',
    'sidebar.favorites': 'Favoritos',
    'sidebar.showArchived': 'Mostrar arquivadas',
    'sidebar.archived': 'Arquivadas',
    'sidebar.onlyPinned': 'Somente fixadas',
    'sidebar.pinned': 'Fixadas',
    'sidebar.tagsPlaceholder': 'Tags (separe por vírgula)',
    'sidebar.folders': 'Pastas',
    'sidebar.allNotes': 'Todas as Notas',
    'sidebar.folderNamePlaceholder': 'Nome da pasta',
    'sidebar.create': 'Criar',
    'sidebar.cancel': 'Cancelar',
    'toast.addedToFavorites': 'Adicionada aos favoritos',
    'toast.removedFromFavorites': 'Removida dos favoritos',
    'toast.archived': 'Nota arquivada',
    'toast.unarchived': 'Nota desarquivada',
    'toast.noteDeleted': 'Nota deletada',
    'error.updateNote': 'Erro ao atualizar a nota',
    'error.createNote': 'Erro ao criar a nota',
    'error.unexpectedSave': 'Erro inesperado ao salvar a nota',
    'error.updateFavorite': 'Erro ao atualizar favorito',
    'error.updateArchived': 'Erro ao atualizar arquivamento',
    'error.unknown': 'Erro desconhecido',
    'error.deleteNote': 'Erro ao deletar a nota',
    'error.unexpectedDeleteNote': 'Erro inesperado ao deletar a nota',
    'confirm.deleteNote.title': 'Deletar nota',
    'confirm.deleteNote.description': 'Tem certeza que deseja deletar esta nota? Esta ação não pode ser desfeita.',
    'common.delete': 'Deletar',
    'common.cancel': 'Cancelar',
    'loading.title': 'Carregando...',
    'loading.subtitle': 'Preparando seu workspace',
    'unauth.subtitle': 'Seu Workspace de Produtividade Definitivo',
    'unauth.cta': 'Começar',
    'unsaved.title': 'Mudanças Não Salvas',
    'unsaved.message': 'Você tem mudanças não salvas nesta nota. O que você gostaria de fazer?',
    'unsaved.saveAndContinue': 'Salvar e Continuar',
    'unsaved.discard': 'Descartar Mudanças',
    'sync.indicator': 'Sincronizando...',
    'errorBanner.reload': 'Recarregar',
    'kanban.loading': 'Carregando Kanban...',
    'kanban.noBoardTitle': 'Nenhum Board Disponível',
    'kanban.noBoardSubtitle': 'Crie um novo board para começar',
    'kanban.createBoard': 'Criar Board',
    'kanban.title': 'Kanban',
    'kanban.selectBoard': 'Selecionar board',
    'kanban.newBoard': 'Novo board',
    'kanban.renameBoard': 'Renomear board',
    'kanban.deleteBoard': 'Excluir board',
    'kanban.shareBoard': 'Compartilhar board',
    'kanban.share': 'Compartilhar',
    'kanban.addCard': 'Adicionar card',
    'kanban.newColumn': 'Nova coluna',
    'kanban.columnAddCard': 'Adicionar card',
    'kanban.createNewCard': 'Criar novo card',
    'kanban.field.title': 'Título',
    'kanban.field.description': 'Descrição',
    'kanban.field.assignee': 'Responsável',
    'kanban.field.priority': 'Prioridade',
    'kanban.field.dueDate': 'Data de vencimento',
    'kanban.priority.low': 'Baixa',
    'kanban.priority.medium': 'Média',
    'kanban.priority.high': 'Alta',
    'kanban.cancel': 'Cancelar',
    'kanban.create': 'Criar',
    'kanban.creating': 'Criando...',
    'kanban.renameBoardTitle': 'Renomear Board',
    'kanban.newColumnTitle': 'Nova Coluna',
    'kanban.createColumn': 'Criar',
    'kanban.confirm.deleteBoard.title': 'Excluir board',
    'kanban.confirm.deleteBoard.desc': 'Esta ação não pode ser desfeita. Deseja excluir o board?',
    'kanban.confirm.delete': 'Excluir',
    'kanban.confirm.deleteCard.title': 'Excluir card',
    'kanban.confirm.deleteCard.desc': 'Esta ação não pode ser desfeita. Deseja excluir o card?',
    'kanban.sharedBy': 'Compartilhado por',
    'kanban.cardCreated': 'Card criado com sucesso.',
    'kanban.cardCreateError': 'Erro ao criar card.',
    'kanban.cardUpdated': 'Card atualizado.',
    'kanban.cardUpdateError': 'Erro inesperado ao atualizar card.',
    'kanban.boardRenamed': 'Board renomeado com sucesso.',
    'kanban.boardRenameError': 'Erro ao renomear o board.',
    'kanban.boardDeleteError': 'Erro ao excluir o board.',
    'kanban.boardDeleted': 'Board excluído.',
    'kanban.noPermissionShare': 'Você não tem permissão para compartilhar este board.',
    'kanban.noPermissionCreateCards': 'Você não tem permissão para criar cards.',
    'kanban.noColumnsAvailable': 'Nenhuma coluna disponível para adicionar card.',
    'kanban.noPermissionCreateColumns': 'Você não tem permissão para criar colunas.',
    'kanban.moveCardError': 'Erro ao mover o card.',
    'kanban.loadBoardError': 'Erro ao carregar o board.',

    'calendar.title': 'Calendário',
    'calendar.enableNotifications': 'Ativar Notificações',
    'calendar.newEvent': 'Novo Evento',
    'calendar.createNewEvent': 'Criar Novo Evento',
    'calendar.eventTitle': 'Título do Evento',
    'calendar.enterEventTitle': 'Digite o título do evento',
    'calendar.description': 'Descrição',
    'calendar.date': 'Data',
    'calendar.time': 'Hora',
    'calendar.eventColor': 'Cor do Evento',
    'calendar.setReminder': 'Ativar lembrete',
    'calendar.reminderTime': 'Tempo do Lembrete',
    'calendar.cancel': 'Cancelar',
    'calendar.createEvent': 'Criar Evento',
    'calendar.editEvent': 'Editar Evento',
    'calendar.updateEvent': 'Atualizar Evento',
    'calendar.noEventsOnDay': 'Sem eventos neste dia',
    'calendar.more': 'mais',
    'calendar.reminderTitle': 'Lembrete de Evento',
    'calendar.startsIn': 'começa em',
    'companies.loading': 'Carregando empresas...',
    'companies.manage': 'Gerenciar Empresas',
    'companies.new': 'Nova Empresa',
    'companies.createdAt': 'Criada em',
    'companies.none': 'Nenhuma Empresa',
    'companies.createFirst': 'Crie sua primeira empresa para começar a colaborar',
    'companies.name': 'Nome da Empresa',
    'companies.namePlaceholder': 'Digite o nome da empresa',
    'companies.description': 'Descrição (opcional)',
    'companies.descriptionPlaceholder': 'Descrição da empresa',
    'companies.create': 'Criar Empresa',
    'companies.inviteTo': 'Convidar para',
    'companies.userEmail': 'Email do Usuário',
    'companies.userEmailPlaceholder': 'usuario@exemplo.com',
    'companies.role': 'Função',
    'companies.role.member': 'Membro',
    'companies.role.admin': 'Administrador',
    'companies.sendInvite': 'Enviar Convite',
    'companies.membersOf': 'Membros de',
    'companies.edit': 'Editar empresa',
    'companies.removeMember': 'Remover membro',

    'common.close': 'Fechar',

    'auth.welcomeBack': 'Bem-vindo de Volta',
    'auth.createAccount': 'Criar Conta',
    'auth.subtitleLogin': 'Entre para acessar seu workspace',
    'auth.subtitleSignup': 'Junte-se ao Scribe para começar',
    'auth.fullName': 'Nome Completo',
    'auth.email': 'Email',
    'auth.password': 'Senha',
    'auth.confirmPassword': 'Confirmar Senha',
    'auth.enterFullName': 'Digite seu nome completo',
    'auth.enterEmail': 'Digite seu email',
    'auth.enterPassword': 'Digite sua senha',
    'auth.enterConfirmPassword': 'Confirme sua senha',
    'auth.submitLogin': 'Entrar',
    'auth.submitSignup': 'Criar Conta',
    'auth.orContinueWith': 'Ou continue com',
    'auth.google': 'Google',
    'auth.github': 'GitHub',
    'auth.noAccount': 'Não tem uma conta? ',
    'auth.haveAccount': 'Já tem uma conta? ',
    'auth.createAccountAction': 'Criar conta',
    'auth.loginAction': 'Entrar',
    'auth.forgotPassword': 'Esqueceu sua senha?',
    'auth.reset.title': 'Redefinir Senha',
    'auth.reset.emailSentTitle': 'Email Enviado',
    'auth.reset.descEnter': 'Digite seu email para receber um link de redefinição',
    'auth.reset.descSent': 'Enviamos um link para redefinir sua senha',
    'auth.reset.sendLink': 'Enviar Link de Redefinição',
    'auth.reset.sending': 'Enviando...',
    'auth.backToLogin': 'Voltar ao Login',
    'auth.verify.title': 'Verifique seu Email',
    'auth.verify.sentTo': 'Enviamos um link de confirmação para',
    'auth.verify.instructions': 'Por favor, verifique seu email e clique no link de confirmação para ativar sua conta. Depois disso, você poderá fazer login para acessar seu workspace.',
    'auth.verify.resend': 'Reenviar email de confirmação',
    'auth.verify.resending': 'Reenviando...'
  },
  en: {
    'settings.title': 'Settings',
    'settings.close': 'Close settings',
    'settings.darkTheme': 'Dark theme',
    'settings.autoRefresh': 'Notes auto-refresh',
    'settings.doNotDisturb': 'Do not disturb (toasts)',
    'settings.language': 'Language',
    'lang.pt': 'Portuguese (Brazil)',
    'lang.en': 'English',
    'common.active': 'Active',
    'common.inactive': 'Inactive',
    'refresh.off': 'Off',
    'refresh.15s': '15 seconds',
    'refresh.30s': '30 seconds',
    'refresh.1m': '1 minute',
    'editor.loading': 'Loading editor...',
    'editor.titlePlaceholder': 'Note title...',
    'editor.bold': 'Bold',
    'editor.italic': 'Italic',
    'editor.underline': 'Underline',
    'editor.strike': 'Strikethrough',
    'editor.heading1': 'Heading 1',
    'editor.heading2': 'Heading 2',
    'editor.heading3': 'Heading 3',
    'editor.bulletList': 'Bulleted list',
    'editor.orderedList': 'Ordered list',
    'editor.taskList': 'Task list',
    'editor.alignLeft': 'Align left',
    'editor.alignCenter': 'Align center',
    'editor.alignRight': 'Align right',
    'editor.codeInline': 'Inline code',
    'editor.codeBlock': 'Code block',
    'editor.horizontalRule': 'Horizontal rule',
    'editor.insertImage': 'Insert image',
    'editor.prompt.imageUrl': 'Enter image URL:',
    'editor.textColor': 'Text color',
    'editor.prompt.textColor': 'Enter color (e.g., #ff0000, red, blue):',
    'editor.fontFamily': 'Font family',
    'editor.prompt.fontFamily': 'Enter font (e.g., Arial, Times New Roman, Courier):',
    'editor.subscript': 'Subscript',
    'editor.superscript': 'Superscript',
    'editor.highlight': 'Highlight text',
    'editor.prompt.highlightColor': 'Enter highlight color (e.g., #ffff00, yellow, orange):',
    'editor.characters': 'characters',
    'editor.tags': 'Tags',
    'editor.addTag': 'Add Tag',
    'editor.removeTag': 'Remove tag',
    'editor.tagNamePlaceholder': 'Tag name',
    'editor.add': 'Add',
    'editor.cancel': 'Cancel',
    'editor.noNoteSelected.title': 'No Note Selected',
    'editor.noNoteSelected.subtitle': 'Select a note from the sidebar or create a new one',
    'editor.compareHeader': 'Compare with another note',
    'editor.compareInstruction': 'Select another note to compare with the current note',
    'editor.closeCompare': 'Close comparison',
    'editor.noContent': 'No content',
    'editor.unpin': 'Unpin note',
    'editor.pin': 'Pin note',
    'editor.unfavorite': 'Remove from favorites',
    'editor.favorite': 'Add to favorites',
    'editor.unarchive': 'Unarchive',
    'editor.archive': 'Archive',
    'editor.toggleSplit': 'Toggle split view',
    'editor.templates': 'Templates',
    'editor.exportMarkdown': 'Export Markdown',
    'editor.exportHtml': 'Export HTML',
    'editor.exportPdf': 'Export PDF',
    'editor.exportZip': 'Export ZIP (MD+HTML)',
    'editor.importMdHtml': 'Import Markdown/HTML',
    'editor.delete': 'Delete note',
    'editor.save': 'Save',
    'editor.saveWithStar': 'Save*',
    'sidebar.newNote': 'New note',
    'sidebar.newFolder': 'New Folder',
    'sidebar.filterFavorites': 'Filter favorites',
    'sidebar.favorites': 'Favorites',
    'sidebar.showArchived': 'Show archived',
    'sidebar.archived': 'Archived',
    'sidebar.onlyPinned': 'Only pinned',
    'sidebar.pinned': 'Pinned',
    'sidebar.tagsPlaceholder': 'Tags (comma separated)',
    'sidebar.folders': 'Folders',
    'sidebar.allNotes': 'All Notes',
    'sidebar.folderNamePlaceholder': 'Folder name',
    'sidebar.create': 'Create',
    'sidebar.cancel': 'Cancel',
    'toast.addedToFavorites': 'Added to favorites',
    'toast.removedFromFavorites': 'Removed from favorites',
    'toast.archived': 'Note archived',
    'toast.unarchived': 'Note unarchived',
    'toast.noteDeleted': 'Note deleted',
    'error.updateNote': 'Error updating note',
    'error.createNote': 'Error creating note',
    'error.unexpectedSave': 'Unexpected error while saving the note',
    'error.updateFavorite': 'Error updating favorite',
    'error.updateArchived': 'Error updating archived status',
    'error.unknown': 'Unknown error',
    'error.deleteNote': 'Error deleting note',
    'error.unexpectedDeleteNote': 'Unexpected error while deleting the note',
    'confirm.deleteNote.title': 'Delete note',
    'confirm.deleteNote.description': 'Are you sure you want to delete this note? This action cannot be undone.',
    'common.delete': 'Delete',
    'common.cancel': 'Cancel',
    'loading.title': 'Loading...',
    'loading.subtitle': 'Preparing your workspace',
    'unauth.subtitle': 'Your ultimate productivity workspace',
    'unauth.cta': 'Get started',
    'unsaved.title': 'Unsaved Changes',
    'unsaved.message': 'You have unsaved changes in this note. What would you like to do?',
    'unsaved.saveAndContinue': 'Save and Continue',
    'unsaved.discard': 'Discard Changes',
    'sync.indicator': 'Syncing...',
    'errorBanner.reload': 'Reload',
    'kanban.loading': 'Loading Kanban...',
    'kanban.noBoardTitle': 'No Board Available',
    'kanban.noBoardSubtitle': 'Create a new board to get started',
    'kanban.createBoard': 'Create Board',
    'kanban.title': 'Kanban',
    'kanban.selectBoard': 'Select board',
    'kanban.newBoard': 'New board',
    'kanban.renameBoard': 'Rename board',
    'kanban.deleteBoard': 'Delete board',
    'kanban.shareBoard': 'Share board',
    'kanban.share': 'Share',
    'kanban.addCard': 'Add card',
    'kanban.newColumn': 'New column',
    'kanban.columnAddCard': 'Add card',
    'kanban.createNewCard': 'Create New Card',
    'kanban.field.title': 'Title',
    'kanban.field.description': 'Description',
    'kanban.field.assignee': 'Assignee',
    'kanban.field.priority': 'Priority',
    'kanban.field.dueDate': 'Due Date',
    'kanban.priority.low': 'Low',
    'kanban.priority.medium': 'Medium',
    'kanban.priority.high': 'High',
    'kanban.cancel': 'Cancel',
    'kanban.create': 'Create',
    'kanban.creating': 'Creating...',
    'kanban.renameBoardTitle': 'Rename Board',
    'kanban.newColumnTitle': 'New Column',
    'kanban.createColumn': 'Create',
    'kanban.confirm.deleteBoard.title': 'Delete board',
    'kanban.confirm.deleteBoard.desc': 'This action cannot be undone. Delete the board?',
    'kanban.confirm.delete': 'Delete',
    'kanban.confirm.deleteCard.title': 'Delete card',
    'kanban.confirm.deleteCard.desc': 'This action cannot be undone. Delete the card?',
    'kanban.sharedBy': 'Shared by',
    'kanban.cardCreated': 'Card created successfully.',
    'kanban.cardCreateError': 'Error creating card.',
    'kanban.cardUpdated': 'Card updated.',
    'kanban.cardUpdateError': 'Unexpected error updating card.',
    'kanban.boardRenamed': 'Board renamed successfully.',
    'kanban.boardRenameError': 'Error renaming board.',
    'kanban.boardDeleteError': 'Error deleting board.',
    'kanban.boardDeleted': 'Board deleted.',
    'kanban.noPermissionShare': 'You do not have permission to share this board.',
    'kanban.noPermissionCreateCards': 'You do not have permission to create cards.',
    'kanban.noColumnsAvailable': 'No columns available to add a card.',
    'kanban.noPermissionCreateColumns': 'You do not have permission to create columns.',
    'kanban.moveCardError': 'Error moving card.',
    'kanban.loadBoardError': 'Error loading board.',

    'calendar.title': 'Calendar',
    'calendar.enableNotifications': 'Enable Notifications',
    'calendar.newEvent': 'New Event',
    'calendar.createNewEvent': 'Create New Event',
    'calendar.eventTitle': 'Event Title',
    'calendar.enterEventTitle': 'Enter event title',
    'calendar.description': 'Description',
    'calendar.date': 'Date',
    'calendar.time': 'Time',
    'calendar.eventColor': 'Event Color',
    'calendar.setReminder': 'Set reminder',
    'calendar.reminderTime': 'Reminder Time',
    'calendar.cancel': 'Cancel',
    'calendar.createEvent': 'Create Event',
    'calendar.editEvent': 'Edit Event',
    'calendar.updateEvent': 'Update Event',
    'calendar.noEventsOnDay': 'No events on this day',
    'calendar.more': 'more',
    'calendar.reminderTitle': 'Event Reminder',
    'calendar.startsIn': 'starts in',
    'companies.loading': 'Loading companies...',
    'companies.manage': 'Manage Companies',
    'companies.new': 'New Company',
    'companies.createdAt': 'Created on',
    'companies.none': 'No Companies',
    'companies.createFirst': 'Create your first company to start collaborating',
    'companies.name': 'Company Name',
    'companies.namePlaceholder': 'Enter company name',
    'companies.description': 'Description (optional)',
    'companies.descriptionPlaceholder': 'Company description',
    'companies.create': 'Create Company',
    'companies.inviteTo': 'Invite to',
    'companies.userEmail': 'User Email',
    'companies.userEmailPlaceholder': 'user@example.com',
    'companies.role': 'Role',
    'companies.role.member': 'Member',
    'companies.role.admin': 'Admin',
    'companies.sendInvite': 'Send Invite',
    'companies.membersOf': 'Members of',
    'companies.edit': 'Edit company',
    'companies.removeMember': 'Remove member',

    'common.close': 'Close',

    'auth.welcomeBack': 'Welcome Back',
    'auth.createAccount': 'Create Account',
    'auth.subtitleLogin': 'Sign in to access your workspace',
    'auth.subtitleSignup': 'Join Scribe to get started',
    'auth.fullName': 'Full Name',
    'auth.email': 'Email',
    'auth.password': 'Password',
    'auth.confirmPassword': 'Confirm Password',
    'auth.enterFullName': 'Enter your full name',
    'auth.enterEmail': 'Enter your email',
    'auth.enterPassword': 'Enter your password',
    'auth.enterConfirmPassword': 'Confirm your password',
    'auth.submitLogin': 'Sign In',
    'auth.submitSignup': 'Create Account',
    'auth.orContinueWith': 'Or continue with',
    'auth.google': 'Google',
    'auth.github': 'GitHub',
    'auth.noAccount': "Don't have an account? ",
    'auth.haveAccount': 'Already have an account? ',
    'auth.createAccountAction': 'Create account',
    'auth.loginAction': 'Sign in',
    'auth.forgotPassword': 'Forgot your password?',
    'auth.reset.title': 'Reset Password',
    'auth.reset.emailSentTitle': 'Email Sent',
    'auth.reset.descEnter': 'Enter your email to receive a reset link',
    'auth.reset.descSent': 'We sent you a link to reset your password',
    'auth.reset.sendLink': 'Send Reset Link',
    'auth.reset.sending': 'Sending...',
    'auth.backToLogin': 'Back to Login',
    'auth.verify.title': 'Check your Email',
    'auth.verify.sentTo': 'We sent a confirmation link to',
    'auth.verify.instructions': 'Please check your email and click the confirmation link to activate your account. After that, you can sign in to access your workspace.',
    'auth.verify.resend': 'Resend confirmation email',
    'auth.verify.resending': 'Resending...'
  },
};

interface I18nContextValue {
  lang: LanguageCode;
  setLang: (lang: LanguageCode) => void;
  t: (key: string) => string;
}

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [lang, setLang] = useState<LanguageCode>(() => {
    if (typeof window === 'undefined') return 'pt-BR';
    const saved = window.localStorage.getItem('settings:lang') as LanguageCode | null;
    return saved === 'en' ? 'en' : 'pt-BR';
  });

  useEffect(() => {
    try {
      window.localStorage.setItem('settings:lang', lang);
    } catch {}
  }, [lang]);

  const t = useCallback((key: string) => {
    const dict = DICTS[lang] || DICTS['pt-BR'];
    return dict[key] ?? key;
  }, [lang]);

  const value = useMemo<I18nContextValue>(() => ({ lang, setLang, t }), [lang, t]);

  return (
    <I18nContext.Provider value={value}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
}

export function useDateFormatter() {
  const { lang } = useI18n();

  const toDate = (input: Date | string | number) => {
    if (input instanceof Date) return input;
    if (typeof input === 'number') return new Date(input);
    const parsed = new Date(input);
    return isNaN(parsed.getTime()) ? new Date() : parsed;
  };

  const formatDate = useCallback((date: Date | string | number, options?: Intl.DateTimeFormatOptions) => {
    const d = toDate(date);
    return new Intl.DateTimeFormat(lang, options ?? { year: 'numeric', month: '2-digit', day: '2-digit' }).format(d);
  }, [lang]);

  const formatMonthYear = useCallback((date: Date | string | number) => {
    const d = toDate(date);
    return new Intl.DateTimeFormat(lang, { month: 'long', year: 'numeric' }).format(d);
  }, [lang]);

  const formatLongDate = useCallback((date: Date | string | number) => {
    const d = toDate(date);
    return new Intl.DateTimeFormat(lang, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }).format(d);
  }, [lang]);

  const getWeekdayShortNames = useCallback(() => {
    // Generate short names starting from Sunday (0) to Saturday (6)
    const base = new Date(Date.UTC(2021, 7, 1)); // 2021-08-01 is a Sunday
    const names: string[] = [];
    for (let i = 0; i < 7; i++) {
      const d = new Date(base);
      d.setUTCDate(base.getUTCDate() + i);
      names.push(new Intl.DateTimeFormat(lang, { weekday: 'short' }).format(d));
    }
    return names;
  }, [lang]);

  return { formatDate, formatMonthYear, formatLongDate, getWeekdayShortNames };
}


